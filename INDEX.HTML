fetch('https://raw.githubusercontent.com/akarimvand/PIPING_DB/main/DB.TXT')
    .then(response => response.text())
    .then(data => {
        const rows = data.trim().split('\n').slice(1); // سطر اول (هدر) را نادیده بگیرید
        const tpSelect = $('#tp-select');

        rows.forEach(row => {
            const [tp, rt, pt, pwht, weld, fitup] = row.split(',');
            if (tp) {
                tpSelect.append(`<option value="${tp}">${tp}</option>`);
            }
        });

        tpSelect.change(function() {
            const selectedTp = $(this).val();
            const selectedRow = rows.find(row => row.startsWith(selectedTp));
            if (selectedRow) {
                const [tp, rt, pt, pwht, weld, fitup] = selectedRow.split(',');
                $('#tp-info').html(`
                    <strong>TP:</strong> ${tp}<br>
                    <strong>RT:</strong> ${rt}<br>
                    <strong>PT:</strong> ${pt}<br>
                    <strong>PWHT:</strong> ${pwht}<br>
                    <strong>Weld:</strong> ${weld}<br>
                    <strong>Fitup:</strong> ${fitup}
                `);

                updateChart('weldChart', 'Weld', parseFloat(weld));
                updateChart('fitupChart', 'Fitup', parseFloat(fitup));
            }
        });
    })
    .catch(error => console.error('خطا در خواندن فایل:', error));
